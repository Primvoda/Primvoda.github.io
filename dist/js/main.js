document.addEventListener("DOMContentLoaded",()=>{function a(a){const b=document.getElementById("canvas"),c=b.getContext("2d");b.width=a.width,b.height=a.height,c.drawImage(a,0,0);const d=c.getImageData(0,0,b.width,b.height),e=d.data;let f=[];for(let b=0;b<e.length;b+=4)f.push(e[b],e[b+1],e[b+2]);f=f.filter(a=>0!==a);const g=new TextDecoder("utf-8"),h=g.decode(new Uint8Array(f));try{const a=atob(h),c=JSON.parse(a),d=Math.min(...c.map(a=>a.depth)),e=Math.max(...c.map(a=>a.depth));return b.style.display="none",c}catch(a){return[]}}function b(a,b){f=L.map("map",{zoomControl:!0,minZoom:9,maxZoom:16}).setView([43.35,132.19],9),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"\xA9 OpenStreetMap"}).addTo(f),c(a),d(b),e()}function c(a){g&&f.removeLayer(g),0<a.length&&(g=L.heatLayer(a,{radius:50,blur:30,maxZoom:18,gradient:{.1:"rgba(173, 255, 47, 1)",.3:"rgba(50, 205, 50, 1)",.5:"rgba(34, 139, 34, 1)",.7:"rgba(0, 100, 0, 1)",1:"rgba(0, 50, 0, 1)"}}).addTo(f))}function d(a){const b=L.layerGroup(),c=["#A6D5E8","#6BB9E8","#3A89C9","#1E5A8A","#0A2E4E"];a.forEach(a=>{const[d,e,f]=a,g=f*j;let h=20>g?c[0]:40>g?c[1]:60>g?c[2]:80>g?c[3]:c[4];const i=L.circle([d,e],{radius:50,fillColor:h,fillOpacity:.8,color:"#000",weight:0});b.addLayer(i)}),f.on("zoomend",()=>{16===f.getZoom()?f.addLayer(b):f.removeLayer(b)})}function e(){const a=L.control({position:"topright"});a.onAdd=function(){const a=L.DomUtil.create("div","leaflet-bar leaflet-control"),b=L.DomUtil.create("button","leaflet-control-locate");return b.innerHTML="<i class=\"bi bi-geo-alt\"></i>",b.title="\u041D\u0430\u0439\u0442\u0438 \u043C\u043E\u0451 \u043C\u0435\u0441\u0442\u043E\u043F\u043E\u043B\u043E\u0436\u0435\u043D\u0438\u0435",b.style.fontSize="14px",b.style.cursor="pointer",b.style.border="none",b.style.background="white",b.style.padding="5px 10px",b.style.borderRadius="4px",b.onclick=()=>{f.locate({setView:!0,maxZoom:16,enableHighAccuracy:!0})},a.appendChild(b),a},a.addTo(f),f.on("locationfound",a=>{f.setView(a.latlng,16)}),f.on("locationerror",a=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u043C\u0435\u0441\u0442\u043E\u043F\u043E\u043B\u043E\u0436\u0435\u043D\u0438\u044F:",a.message)})}let f,g,h=[],i=[];const j=80,k=document.getElementById("data-image");if(k.complete){const c=a(k);h=c.map(a=>[a.lat,a.lng,.8]),i=c.map(a=>[a.lat,a.lng,a.depth]),b(h,i)}else k.onload=()=>{const c=a(k);h=c.map(a=>[a.lat,a.lng,.8]),i=c.map(a=>[a.lat,a.lng,a.depth]),b(h,i)}});